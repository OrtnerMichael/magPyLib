import numpy as np
import magpylib as magpy

def test_cylinder_diametral():
    """ test cylinder diametral fields furlani1994, rauber2021
    """
    tetta = np.array([0.89775434, 0.94217596, 0.9862402,  0.88291641, 0.03614653, 0.93610768,
    0.40860573 ,0.99247571 ,0.8355379  ,0.57216078, 0.48303772, 0.40681908,
    0.86952975 ,0.54837047 ,0.51168319 ,0.35658505, 0.70392832, 0.95884772,
    0.5690288  ,0.39482061 ,0.96957217 ,0.9978982 , 0.05935107, 0.87421612,
    0.85684616 ,0.63043337 ,0.02059138 ,0.48540657, 0.63060856, 0.98315478])

    dim = np.array([[0.15185297, 0.64154459],
    [0.75536823, 0.80710784], [0.5209259 , 0.40814131], [0.67089607, 0.53320331],
    [0.00400389, 0.27661026],
    [0.51696779, 0.91092303], [0.36368867, 0.6119539 ], [0.85679847, 0.99748264],
    [0.53487314, 0.78787946],
    [0.50791986, 0.86754658], [0.58604475, 0.48266827], [0.6030603 , 0.05706995],
    [0.84992815, 0.53674384],
    [0.21341077, 0.74502533], [0.92125778, 0.99152291], [0.56155817, 0.80279895],
    [0.90147331, 0.40203837],
    [0.77900363, 0.97689269], [0.98001412, 0.18355643], [0.21151101, 0.53536088],
    [0.67795406, 0.71883683],
    [0.72303636, 0.71275242], [0.4043741 , 0.81367706], [0.75320629, 0.3247651 ],
    [0.56564548, 0.69229636],
    [0.04520636, 0.82278172], [0.80658774, 0.91939904], [0.55610669, 0.31482908],
    [0.809358  , 0.43666357],
    [0.92858009, 0.76807934]])

    obs = np.array([[8.71774153e-01, 1.96667416e-01, 5.54016374e-02],
    [2.50328452e-01,3.75817477e-01,8.49307131e-01], [7.73158268e-01,6.03118881e-01,9.44905713e-02],
    [1.78361331e-01,2.78088946e-01,1.81036452e-01], [7.86876490e-01,3.13162248e-01,7.64232559e-01],
    [7.72430938e-01,3.43586904e-01,2.02130862e-01], [2.57966520e-02,7.79848077e-01,2.23544016e-01],
    [7.07491489e-01,2.00563440e-01,7.80300240e-01], [6.14919813e-02,7.12003536e-01,3.09249888e-01],
    [5.74030215e-01,1.44340504e-02,6.78211635e-01], [5.13622572e-01,4.02081225e-01,2.92690948e-01],
    [9.29195908e-01,8.28616107e-01,3.72209186e-01], [8.75610948e-01,9.57435355e-02,8.18946342e-01],
    [1.38944450e-01,8.87263142e-01,8.72522265e-01], [4.81666515e-01,7.04409625e-01,2.63796920e-01],
    [4.85110045e-02,8.82270898e-01,7.96612455e-01], [6.60529440e-03,6.60010748e-01,3.02026268e-02],
    [4.61925986e-01,6.22031360e-01,9.87655409e-01], [7.61334057e-01,2.33420111e-02,3.55315523e-01],
    [1.02162667e-01,5.64291220e-01,4.16333054e-01], [8.19423138e-01,7.86350029e-01,4.97304397e-02],
    [2.86021248e-01,4.77827643e-01,3.56792058e-01], [8.29430269e-01,3.84654919e-02,2.60090162e-02],
    [3.09548605e-01,1.02023679e-01,2.56449146e-01], [7.34156378e-01,9.52528169e-01,9.53651672e-01],
    [5.61603318e-01,8.37280751e-01,4.88006717e-01], [5.17416492e-04,4.64111452e-01,4.60335025e-01],
    [9.33957124e-01,8.18605047e-01,2.78177542e-01], [5.58570068e-02,8.57444127e-01,4.15788651e-01],
    [1.69506465e-01, 5.47790769e-01, 3.43305054e-02]])

    B1 = magpy.lib.fieldH_cyl_dia_Rauber2021(tetta, dim, obs)
    B2 = magpy.lib.fieldH_cyl_dia_Furlani1994(tetta, dim, obs, 1000)

    assert np.allclose(B1, B2)
